# docker-compose.yml

networks:
    my_network:

volumes:
    db_volume:
        driver: local
        driver_opts:
            type: none
            device: ./database
            o: bind

services:
    frontend:
        container_name: frontend
        build:
            context: ..
            dockerfile: build/frontend/Dockerfile
        restart: unless-stopped
        command: nginx -g 'daemon off;'
        ports:
            - 8000:80
        networks:
            - my_network

    backend:
        container_name: backend
        build:
            context: ..
            dockerfile: build/backend/Dockerfile
        restart: unless-stopped
        command: npm run start:backend
        env_file: ./backend/.env
        volumes:
            - db_volume:/database
        ports:
            - 8080:8080
        networks:
            - my_network

    tunnel:
        container_name: tunnel
        image: cloudflare/cloudflared:latest
        restart: unless-stopped
        command: tunnel --no-autoupdate run --token ${CLOUDFLARE_API_TOKEN}
        networks:
            - my_network
